<div *ngIf="this.play">
  <div *ngIf="this.getSession() != null">


    <div *ngIf="!this.join">
      <div class="card container error align-middle">
        <div class="card-body text-center">
          <img src="../../assets/images/error.png" class="card-img-top" alt="error_img">
          <h1 class="card-title text-center" style="color : red ; font-size : 50px">ERREUR</h1>
          <p class="card-text text-center" style="font-size : 30px">La séssion que vous essayer de rejoindre n'est
            pas rejoignable</p>
        </div>

        <div class="align-middle text-center redirect_button">
          <button mat-raised-button color="primary" aria-label="Valider" [routerLink]="['']">
            <i class="fa-solid fa-angles-left fa-xl"></i>
            Retourner à l'acceuil
          </button>
        </div>

      </div>
    </div>

    <div *ngIf="this.join && !this.connected">
      <div class="card container align-middle">
        <div class="card-header">
          Séssion N ° : {{this.getSession()!.id }}
        </div>

        <div class="card-body">

          <h2 class="card-title text-center">Rejoindre la séssion</h2>
          <div class="input-join align-middle">
            <input type="text" name="" id="" placeholder="Entrez votre nom ici" #input_name
              (keypress)="enterKey($event)">

            <button mat-raised-button color="primary" aria-label="Valider" (click)="connect(input_name.value)">
              <i class="fa fa-check"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="this.connected">
      <div *ngIf="this.jeu == 'abecedaire'">
        <app-abecedaire [game]="this.abecedaire"></app-abecedaire>
      </div>
      <div *ngIf="this.jeu == 'memory'">
        <app-memory [game]="this.memory"></app-memory>
      </div>
      <div *ngIf="this.jeu == 'fillegarcon'">
        <app-boy-girl-game [bg]="this.boyGirl"></app-boy-girl-game>
      </div>
      <div *ngIf="this.jeu == 'puzzle'">
        <app-puzzle [r]="this.puzzle"></app-puzzle>
      </div>
      <div *ngIf="this.jeu == 'reconnaitre'">
        <app-reconnaitre [r]="this.reconnaitre"></app-reconnaitre>
      </div>
      <div *ngIf="this.jeu == 'recopier'">
        <app-recopier-game [r]="this.recopier"></app-recopier-game>
      </div>
    </div>

  </div>

  <div *ngIf="this.getSession() == null">
    <div class="card container error align-middle">
      <div class="card-body text-center">
        <img src="../../assets/images/error.png" class="card-img-top" alt="error_img">
        <h1 class="card-title text-center" style="color : red ; font-size : 50px">ERREUR</h1>
        <p class="card-text text-center" style="font-size : 30px">La séssion que vous essayer de rejoindre n'éxiste pas
        </p>
      </div>

      <div class="align-middle text-center redirect_button">
        <button mat-raised-button color="primary" aria-label="Valider" [routerLink]="['']">
          <i class="fa-solid fa-angles-left fa-xl"></i>
          Retourner à l'acceuil
        </button>
      </div>

    </div>
  </div>
</div>

<div class="card container" *ngIf="this.showList">
  <h5 class="card-header"> Listes des séssions</h5>

  <div class="card-body text-center">
    <div class="col-md-12 text-center sortButton">
      <button mat-raised-button style="background-color : red" (click)="sortSessionId()" color="primary">
        <i class="fa-solid fa-arrow-down-1-9 fa-xl" style="margin-bottom : 2px"></i>
        <span>Trier par Id</span>
      </button>
      <button mat-raised-button style="background-color : red" (click)="sortSessionDate()" color="primary">
        <i class="fa-solid fa-sort-down fa-xl" style="margin-bottom : 2px"></i>
        <span>Trier par date</span>
      </button>
      <button mat-raised-button style="background-color : red" (click)="sortSessionNbJoueur()" color="primary">
        <i class="fa-solid fa-arrow-down-1-9 fa-xl" style="margin-bottom : 2px"></i>
        <span>Trier par nombre de joueur</span>
      </button>

      <button *ngIf="!this.showActive" (click)="this.showActive = true" mat-raised-button style="background-color : red"
        color="primary">
        <i class="fa-solid fa-circle-check fa-xl" style=" margin-bottom : 2px "></i>
        <span>Afficher uniquement les sessions actives</span>
      </button>

      <button *ngIf="this.showActive" (click)="this.showActive = false" mat-raised-button style="background-color : red"
        color="primary">
        <i class="fa-solid fa-eye fa-lg fa-xl" style=" margin-bottom : 2px "></i>
        <span>Afficher toutes les sesssions</span>
      </button>

      <button mat-raised-button style="background-color : rgb(12, 202, 12)" [routerLink]="['/panel/sessions/create']"
        color="primary">
        <i class="fa-solid fa-circle-plus fa-xl"></i>
        <span>Créer une session</span>
      </button>

    </div>

    <div *ngIf="this.getData().length == 0 && !this.showActive">
      <h5 class="card-title" style="color : red">Il n'y a pas de sessions créer</h5>
    </div>

    <div *ngIf="this.getData().length != 0" class="col-md-12">
      <table class="table table-hover" *ngIf="!this.showActive">
        <thead>
          <tr>
            <th scope="col" *ngFor="let col of this.displayedColumns">{{col}}</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let element of this.getData()">
            <th *ngIf="element.isActive">
              <i class="fa-solid fa-circle-check fa-2xl" style="color : green;"></i>
            </th>
            <th *ngIf="!element.isActive">
              <i class="fa-solid fa-circle-xmark fa-2xl" style="color : red"></i>
            </th>
            <th>{{element.id}}</th>
            <th>{{element.nom}}</th>
            <th>{{this.parseDate(element.date)}}</th>
            <th>{{element.jeu}}</th>
            <th>{{element.joueur.length}}</th>
            <th class="button_actions">
              <button mat-raised-button title="Prévisualiser le jeu de la séssion" (click)="previsualiserGame(element)"
                color="primary">
                <i class="fa-solid fa-eye fa-lg fa-lg" style="margin-bottom : 3px"></i>
              </button>
              <button mat-raised-button title="Editer la séssion" (click)="editSession(element)"
                style="background-color : rgb(223, 175, 18)" color="primary">
                <i class="fa-solid fa-pen fa-lg" style=" margin-bottom : 2px"></i>
              </button>
              <button mat-raised-button title="Supprimer la séssion" (click)="deleteSession(element)"
                style="background-color : red" color="primary">
                <i class="fa-solid fa-trash fa-lg" style=" margin-bottom : 2px "></i>
              </button>
              <button mat-raised-button title="Rejoindre la séssion" (click)="joinSession(element)"
                style="background-color : rgb(77, 184, 44)" color="primary">
                <i class="fa-solid fa-right-to-bracket fa-lg" style=" margin-bottom : 2px "></i>
              </button>
              <button *ngIf="!element.isActive" title="Démarrer la séssion" mat-raised-button
                (click)="setSessionActive(element)" style="background-color : rgb(168, 14, 135)" color="primary">
                <i class="fa-solid fa-play fa-lg" style=" margin-bottom : 2px "></i>
              </button>
              <button *ngIf="element.isActive" title="Eteindre la séssion" mat-raised-button
                (click)="setSessionInactive(element)" style="background-color : rgb(168, 14, 135)" color="primary">
                <i class="fa-solid fa-stop fa-lg" style=" margin-bottom : 2px "></i>
              </button>
            </th>

          </tr>
        </tbody>
      </table>
    </div>
    <div *ngIf="this.showActive">

      <div *ngIf="this.getSessionsActive().length == 0">
        <h5 class="card-title" style="color : red">Il n'y a pas de sessions active</h5>
      </div>

      <table class="table table-hover" *ngIf="this.getSessionsActive().length != 0">
        <thead>
          <tr>
            <th scope="col" *ngFor="let col of this.displayedColumns">{{col}}</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let element of this.getSessionsActive()">
            <th *ngIf="element.isActive">
              <i class="fa-solid fa-circle-check fa-2xl" style="color : green;"></i>
            </th>
            <th *ngIf="!element.isActive">
              <i class="fa-solid fa-circle-xmark fa-2xl" style="color : red"></i>
            </th>
            <th>{{element.id}}</th>
            <th>{{element.nom}}</th>
            <th>{{this.parseDate(element.date)}}</th>
            <th>{{element.jeu}}</th>
            <th>{{element.joueur.length}}</th>
            <th class="button_actions">
              <button mat-raised-button title="Prévisualiser le jeu de la séssion" (click)="previsualiserGame(element)"
                color="primary">
                <i class="fa-solid fa-eye fa-lg fa-lg" style="margin-bottom : 3px"></i>
              </button>
              <button mat-raised-button title="Editer la séssion" (click)="editSession(element)"
                style="background-color : rgb(223, 175, 18)" color="primary">
                <i class="fa-solid fa-pen fa-lg" style=" margin-bottom : 2px"></i>
              </button>
              <button mat-raised-button title="Supprimer la séssion" (click)="deleteSession(element)"
                style="background-color : red" color="primary">
                <i class="fa-solid fa-trash fa-lg" style=" margin-bottom : 2px "></i>
              </button>
              <button mat-raised-button title="Rejoindre la séssion" (click)="joinSession(element)"
                style="background-color : rgb(77, 184, 44)" color="primary">
                <i class="fa-solid fa-right-to-bracket fa-lg" style=" margin-bottom : 2px "></i>
              </button>
              <button *ngIf="!element.isActive" title="Démarrer la séssion" mat-raised-button
                (click)="setSessionActive(element)" style="background-color : rgb(168, 14, 135)" color="primary">
                <i class="fa-solid fa-play fa-lg" style=" margin-bottom : 2px "></i>
              </button>
              <button *ngIf="element.isActive" title="Eteindre la séssion" mat-raised-button
                (click)="setSessionInactive(element)" style="background-color : rgb(168, 14, 135)" color="primary">
                <i class="fa-solid fa-stop fa-lg" style=" margin-bottom : 2px "></i>
              </button>
            </th>

          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="card container" *ngIf="this.preview">
  <h5 class="card-header">Prévisualisation du {{this.selected_session!.jeu}} de la séssion
    n°{{this.selected_session!.id}}</h5>

  <div class="card-body text-center">
    <!-- Prévisualisr le jeu d'une séssion -->

    <div class="col-md-12 text-center sortButton">
      <button mat-raised-button style="background-color : red" (click)="this.preview = false; this.showList = true"
        color="primary">
        <i class="fa-solid fa-angles-left" style="margin-bottom : 1px"></i>
        <span>Retourner sur les sessions</span>
      </button>
    </div>

    <div *ngIf="this.selected_session!.jeu == 'Recopier'">
      <app-recopier-game [r]="this.getSessionRecopier(this.selected_session!)" [showTitle]="false"></app-recopier-game>
    </div>
    <div *ngIf="this.selected_session!.jeu == 'Memory'">
      <app-memory [showTitle]="false" [game]="this.getSessionMemory(this.selected_session!)"></app-memory>
    </div>
    <div *ngIf="this.selected_session!.jeu == 'Reconnaitre'">
      <app-reconnaitre [r]="this.getSessionReconnaitre(this.selected_session!)" [showTitle]="false">
      </app-reconnaitre>
    </div>
    <div *ngIf="this.selected_session!.jeu == 'Abecedaire'">
      <app-abecedaire [showTitle]="false" [game]="this.getSessionAbecedaire(this.selected_session!)">
      </app-abecedaire>
    </div>
    <div *ngIf="this.selected_session!.jeu == 'Fille&Garçon'">
      <app-boy-girl-game [showTitle]="false" [bg]="this.getSessionBoyGirl(this.selected_session!)">
      </app-boy-girl-game>
    </div>
    <div *ngIf="this.selected_session!.jeu == 'Puzzle'">
      <app-puzzle [r]="this.getSessionPuzzle(this.selected_session!)" [showTitle]="false"></app-puzzle>

    </div>
  </div>
</div>

<div class="card container" *ngIf="this.create_session">

  <h5 *ngIf="!this.edit" class="card-header">Création d'une séssion</h5>
  <h5 *ngIf="this.edit" class="card-header">édition de la séssion n°{{this.selected_session!.id}}</h5>

  <div class="col-md-12 text-center sortButton">
    <button mat-raised-button style="background-color : red" [routerLink]="['/panel/sessions']" color="primary">
      <i class="fa-solid fa-angles-left" style="margin-bottom : 1px"></i>
      <span>Retourner sur les sessions</span>
    </button>
  </div>

  <div class="form-row">
    <div class="col-md-2 text-center">
      <label for="nom_session" class="form-label align-middle">Nom de la session</label>
    </div>
    <div class="col-md-10 text-center">
      <input value="{{this.session_nom}}" type="text" class="form-control" #nom_session title="Nom de la session">
    </div>
  </div>

  <div class="form-row">
    <div class="col-md-2 text-center">
      <label for="jeu_session" class="form-label align-middle">Jeu</label>
    </div>
    <div class="col-md-10 text-center">
      <select value="{{this.jeuSession}}" class="form-control" aria-label="Default select example"
        (change)="this.changeJeuSession(jeu_session.value)" #jeu_session>
        <option class="text-center"></option>
        <option class="text-center">Recopier</option>
        <option class="text-center">Memory</option>
        <option class="text-center">Reconnaitre</option>
        <option class="text-center">Abecedaire</option>
        <option class="text-center">FilleEtGarcon</option>
        <option class="text-center">Puzzle</option>
      </select>
    </div>
  </div>

  <div *ngIf="jeuSession == 'Recopier'">
    <table class="table table-hover text-center">
      <thead>
        <tr>
          <th scope="col"
            *ngFor="let col of ['ID','Date','Nombre d\'image','Type d\'écriture','Vocalisation','Crée par','']">
            {{col}}</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let element of this.getRecopierList()" (click)="changeJeuId(element.id)">
          <th>{{element.id}}</th> <!-- Id du jeu -->
          <th>{{element.date}}</th>
          <!--Date de création du jeu-->
          <th>{{element.images.length}}</th>
          <!--Nombre d'image qui compose le jeu-->
          <th>{{element.typeEcriture}}</th>
          <!--Type d'écriture du jeu-->
          <th *ngIf="element.isVocaliser">Oui</th>
          <th *ngIf="!element.isVocaliser">Non</th>
          <th>Aucun</th>
          <!--Nom de l'utilisateur qui à créer le jeu-->
          <th *ngIf="this.jeuId == element.id"><i class="fa-solid fa-square-check fa-lg"></i></th>
          <th *ngIf="this.jeuId != element.id"><i class="fa-solid fa-square fa-lg"></i></th>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="jeuSession == 'Memory'">
    <table class="table table-hover text-center">
      <thead>
        <tr>
          <th scope="col" *ngFor="let col of ['Id','Date','Nombre de tuiles','Paramètre','Crée par']">
            {{col}}</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let element of this.getMemoryList()" (click)="changeJeuId(element.id)">
          <th>{{element.id}}</th>
          <!-- Id du jeu
              <th>{{this.parseDate(element.date)}}</th> <!-- Date de création du jeu -->
          <th>{{element.nbTile}}</th> <!-- Nombre de tuile qui compose le jeu -->
          <th>{{element.setting[0]}} / {{element.setting[1]}}</th> <!-- Paramètre du jeu -->
          <th>Aucun</th> <!-- Nom de l'utilisateur qui à créer le jeu -->
          <th *ngIf="this.jeuId == element.id"><i class="fa-solid fa-square-check fa-lg"></i></th>
          <th *ngIf="this.jeuId != element.id"><i class="fa-solid fa-square fa-lg"></i></th>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="jeuSession == 'Reconnaitre'">
    <table class="table table-hover text-center">
      <thead>
        <tr>
          <th scope="col"
            *ngFor="let col of ['ID','Date','Nombre d\'image','Type d\'écriture','Vocalisation','Crée par']">
            {{col}}</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let element of this.getReconnaitreList()" (click)="changeJeuId(element.id)">
          <th>{{element.id}}</th> <!-- Id du jeu -->
          <th>{{element.date}}</th> <!-- Date de création du jeu -->
          <th>{{element.images.length}}</th> <!-- Nombre d'image qui compose le jeu -->
          <th>{{element.typeEcriture}}</th> <!-- Type d'écriture du jeu -->
          <th *ngIf="element.isVocaliser">Oui</th>
          <th *ngIf="!element.isVocaliser">Non</th>
          <th>Aucun</th> <!-- Nom de l'utilisateur qui à créer le jeu -->
          <th *ngIf="this.jeuId == element.id"><i class="fa-solid fa-square-check fa-lg"></i></th>
          <th *ngIf="this.jeuId != element.id"><i class="fa-solid fa-square fa-lg"></i></th>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="jeuSession == 'Abecedaire'">
    <table class="table table-hover text-center">
      <thead>
        <tr>
          <th scope="col"
            *ngFor="let col of ['ID','Date','Nombre d\'image','Type d\'écriture','Vocalisation','Crée par']">
            {{col}}</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let element of this.getAbecedaireList()" (click)="changeJeuId(element.id)">
          <th>{{element.id}}</th> <!-- Id du jeu -->
          <th>{{element.date}}</th> <!-- Date de création du jeu -->
          <th>{{element.images.length}}</th> <!-- Nombre d'image qui compose le jeu -->
          <th>{{element.typeEcriture}}</th> <!-- Type d'écriture du jeu -->
          <th *ngIf="element.isVocaliser">Oui</th>
          <th *ngIf="!element.isVocaliser">Non</th>
          <th>Aucun</th> <!-- Nom de l'utilisateur qui à créer le jeu -->
          <th *ngIf="this.jeuId == element.id"><i class="fa-solid fa-square-check fa-lg"></i></th>
          <th *ngIf="this.jeuId != element.id"><i class="fa-solid fa-square fa-lg"></i></th>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="jeuSession == 'FilleEtGarcon'">
    <table class="table table-hover text-center">
      <thead>
        <tr>
          <th scope="col" *ngFor="let col of ['ID','Date','Mots fille','Mots garçon','Type d\'écriture','Crée par']">
            {{col}}</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let element of this.getBoyGirlList()" (click)="changeJeuId(element.id)">
          <th>{{element.id}}</th> <!-- Id du jeu -->
          <th>{{this.parseDate(element.date)}}</th> <!-- Date de création du jeu -->
          <th>{{element.listMotsFille.length}}</th> <!-- Nombre de mot fille qui compose le jeu -->
          <th>{{element.listMotsGarcon.length}}</th> <!-- Nombre de mot garçon qui compose le jeu -->
          <th>{{element.type_ecriture}}</th> <!-- Type d'écriture du jeu -->
          <th>Aucun</th> <!-- Nom de l'utilisateur qui à créer le jeu -->
          <th *ngIf="this.jeuId == element.id"><i class="fa-solid fa-square-check fa-lg"></i></th>
          <th *ngIf="this.jeuId != element.id"><i class="fa-solid fa-square fa-lg"></i></th>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Bouton création de la séssion -->
  <div *ngIf="!this.edit" class="col-md-12 text-center sortButton">
    <button mat-raised-button style="background-color : rgb(12, 202, 12)"
      (click)="this.createSession(jeu_session.value, nom_session.value)" color="primary">
      <i class="fa-solid fa-plus-circle fa-lg" style="margin-bottom : 1px"></i>
      <span>Créer la sessions</span>
    </button>
  </div>


  <!-- Bouton sauvegarde de la séssion -->
  <div *ngIf="this.edit" class="col-md-12 text-center sortButton">
    <button mat-raised-button style="background-color : rgb(255, 196, 0) ; color : black" (click)="save()"
      color="primary">
      <i class="fa-solid fa-floppy-disk fa-lg" style="margin-bottom : 1px"></i>
      <span>Sauvegarder la sessions</span>
    </button>
  </div>
</div>


<div class="card container" *ngIf="this.view">
  <h5 class="card-header">Visualisation de la séssion</h5>

  <div class="card-body text-center">

    <h2 style="font-size : 80px; letter-spacing : 3px;">N° de séssion : {{this.selected_session!.id}}</h2>


    <div class="col-md-12 text-center sortButton">
      <button mat-raised-button style="background-color : red" (click)="this.view = false; this.showList = true"
        color="primary">
        <i class="fa-solid fa-angles-left" style="margin-bottom : 1px"></i>
        <span>Retourner sur les sessions</span>
      </button>
    </div>

    <div *ngIf="this.selected_session!.joueur.length != 0">
      <div *ngIf="this.selected_session!.isActive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th scope="col">Nom</th>
              <th scope="col">Erreur(s)</th>
              <th scope="col">Progression</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let user of this.selected_session!.joueur">
              <th>{{user.nom}}</th>
              <th>{{user.compteur_erreur}}</th>
              <th>
                <div class="progress">
                  <div id="progressbar" class="progress-bar progress-bar-striped progress-bar-animated"
                    role="progressbar" [ngStyle]="{width: user.progression.toString() + '%'}" aria-valuenow=" 50"
                    aria-valuemin="0" aria-valuemax='100'></div>
                </div>
              </th>
            </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="!this.selected_session!.isActive">
        <h5 class="card-title" style="color : red">La session n'est pas active</h5>
      </div>

    </div>

    <div *ngIf="this.selected_session!.joueur.length == 0">
      <h5 class="card-title" style="color : red">La session n'est pas active</h5>
    </div>
  </div>
</div>
